---
title: "UPDATED_Working_Final_exploratory_Analysis"
output: html_document
date: "2025-03-23"
---

```{r}
#install.packages("tidyverse")
#install.packages("readxl")
#install.packages("ggplot2")
#install.packages("dplyr")
#install.packages("lmtest")
#install.packages("data.table")
#install.packages("sf")
#install.packages("ggspatial")
#install.packages("sandwich")
#install.packages("ggrepel")

library(tidyverse)
library(readxl)
library(ggplot2)
library(dplyr)
library(lmtest)
library(data.table)
library(sf)
library(ggspatial)
library(sandwich)
library(ggrepel)


```

## Rice Price Cleaning and Visualization

```{r}
rice_data <- read.csv("~/Downloads/Rice_Updated_merged_cleaned_data.csv")

rice_cleaned <- rice_data %>%
  filter(str_detect(commodity, regex("Rice", ignore_case = TRUE))) %>%
  mutate(
    unit = as.character(unit),
    PRICE_KG = case_when(
      unit == "100 KG" ~ as.numeric(price) / 100,
      unit == "KG" ~ as.numeric(price),
      unit == "L" ~ as.numeric(price),  # assuming L ≈ KG
      TRUE ~ NA_real_
    ),
    YEAR = as.numeric(year),
    LOCATION = as.character(admin1)
  ) %>%
  filter(!is.na(PRICE_KG)) %>%
  select(YEAR, LOCATION, PRICE_KG)

avg_price_div_year <- rice_cleaned %>%
  group_by(LOCATION, YEAR) %>%
  summarise(avg_price = mean(PRICE_KG, na.rm = TRUE), .groups = "drop")

```


## Loading and Filter IPUMS Data


```{r}



ipums_paths <- list(
  "~/Desktop/IPUMS_DATASETS/ipumsi_00014.csv.gz",
  "~/Desktop/IPUMS_DATASETS/ipumsi_00015 (2).csv.gz",
  "~/Desktop/IPUMS_DATASETS/ipumsi_00016.csv.gz"
)




```




```{r}


# Calculating contribution
rice_contribution <- rice_cleaned %>%
  group_by(LOCATION) %>%
  summarise(total_price = sum(PRICE_KG, na.rm = TRUE)) %>%
  mutate(percent_contribution = total_price / sum(total_price) * 100) %>%
  arrange(desc(percent_contribution))

# Plotting
# Plotting and assigning to object
rice_contribution_plot <- ggplot(rice_contribution, aes(x = reorder(LOCATION, percent_contribution), 
                                                        y = percent_contribution, 
                                                        fill = LOCATION == "Dhaka")) +
  geom_col(width = 0.7) +
  scale_fill_manual(values = c("TRUE" = "steelblue", "FALSE" = "lightblue")) +
  geom_text(aes(label = sprintf("%.1f%%", percent_contribution)),
            hjust = -0.1, size = 3.5, color = "black") +
  labs(
    title = "Division-Wise Contribution to Total Rice Market",
    subtitle = "Based on Sum of Price Observations (BDT per KG)",
    x = NULL,
    y = "Contribution (%)",
    fill = NULL
  ) +
  coord_flip() +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 11),
    axis.text.x = element_text(size = 10),
    axis.text.y = element_text(size = 11)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.1)))



```

This figure shows the proportional contribution of each division to total rice price data, based on number of price entries (sum of observations). Dhaka contributes nearly half of all entries, possibly due to overrepresentation or reporting differences.




# Now, to observe the seasonal trends by months across years


```{r}

#install.packages("lubridate")
# Load necessary libraries
library(tidyverse)
library(lubridate)

# Convert the date column safely
rice_monthly <- rice_data %>%
  mutate(
    date = parse_date_time(date, orders = c("mdy", "ymd", "dmy"), tz = "Asia/Dhaka"),
    year = year(date),
    month = lubridate::month(date, label = TRUE, abbr = TRUE)
  ) %>%
  filter(!is.na(date), !is.na(price))  # remove rows with NA dates or prices



```

```{r}


# Calculate monthly average rice price
monthly_avg <- rice_monthly %>%
  group_by(year, month) %>%
  summarise(avg_price = mean(as.numeric(price), na.rm = TRUE), .groups = "drop")

# Step 3: Plot monthly trends
ggplot(monthly_avg, aes(x = month, y = avg_price, group = year, color = as.factor(year))) +
  geom_line(size = 1) +
  labs(
    title = "Monthly Rice Price Patterns Across Years",
    x = "Month", y = "Average Price (BDT)",
    color = "Year"
  ) +
  theme_minimal()




```
it looks visually overcrowded and some legend/line overlaps make it hard to interpret.

```{r}

# Adding a new decade grouping
monthly_avg <- monthly_avg %>%
  mutate(decade = case_when(
    year < 2005 ~ "1998–2004",
    year < 2010 ~ "2005–2009",
    year < 2015 ~ "2010–2014",
    TRUE        ~ "2015–2020"
  ))

# Plot using facet wrap for easier comparison
ggplot(monthly_avg, aes(x = month, y = avg_price, group = year, color = as.factor(year))) +
  geom_line(size = 1) +
  facet_wrap(~decade, scales = "free_y") +
  labs(
    title = "Monthly Rice Price Patterns Across Years",
    subtitle = "Faceted by Decade",
    x = "Month", y = "Average Price (BDT)",
    color = "Year"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom"
  )

```



```{r}

ggplot(monthly_avg, aes(x = month, y = avg_price, group = year, color = as.factor(year))) +
  geom_smooth(se = FALSE, size = 1, method = "loess") +
  labs(
    title = "Smoothed Monthly Rice Price Trends",
    x = "Month", y = "Average Price (BDT)",
    color = "Year"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")







```


```{r}

## Monthly Rice Price Seasonality Across All Years

# Group by month only and average across all years
monthly_seasonal <- monthly_avg %>%
  group_by(month) %>%
  summarise(avg_price = mean(avg_price, na.rm = TRUE), .groups = "drop")

# Create the plot
# Assign the plot to an object
monthly_seasonal_plot <- ggplot(monthly_seasonal, aes(x = month, y = avg_price)) +
  geom_line(group = 1, color = "darkred", size = 1.2) +
  geom_point(color = "black", size = 2) +
  labs(
    title = "Average Monthly Rice Price Seasonality",
    subtitle = "Across All Years",
    x = "Month",
    y = "Avg Price (BDT)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold"),
    axis.text.x = element_text(angle = 0, vjust = 0.5)
  )

# Save the plot
ggsave("Plots/monthly_seasonal_plot.png", plot = monthly_seasonal_plot, width = 8, height = 5, dpi = 300)


```
# Interpretation: Rice Price Seasonality in Bangladesh:
This line graph shows how the average rice price (in BDT) changes throughout the year, based on monthly data aggregated across all years in your dataset. It reveals a clear seasonal pattern in rice pricing, likely tied to the agricultural calendar and market dynamics.

# Peaks and High Prices
February marks the highest average rice price, peaking above 640 BDT.

- Prices also rise again in August, and gradually through November and December, indicating secondary periods of increased cost.

- These peaks may align with lean seasons, when harvested rice is less available and demand exceeds supply, especially before new crops are brought to market.

# Troughs and Low Prices
The lowest prices occur in May, dropping below 500 BDT.

The sharp decline from February to May suggests increased availability of rice, likely due to Boro harvest season, which is one of the largest rice harvests in Bangladesh.

Prices begin recovering from June onward, likely as stored supply depletes and before the next major harvest arrives.

# Possible Explanations
- Agricultural cycles — Prices fall after harvests and rise before them.

- Supply increases — May's low prices may be driven by high market availability.

- Pre-harvest scarcity — February and August peaks could reflect low supply before harvests, or stockpiling behaviors.

- Festive or seasonal demand — Cultural events may also influence temporary spikes.

# Summary:
This seasonal trend in rice pricing has real implications for rural livelihoods, household food security, and market interventions. Policymakers might consider price stabilization strategies or targeted support during high-price months, especially for vulnerable populations.





```{r}
# Loading required packages
library(dplyr)
library(readr)

keep_cols <- c("YEAR", "URBAN", "FAMSIZE", "NCHILD")

ipums_2011 <- read_csv("~/Desktop/IPUMS_DATASETS/IPUMS_2011.csv") %>%
  select(all_of(keep_cols)) %>%
  mutate(
    YEAR = 2011,
    LOCATION = "Rajshahi"
  )




```
Child dependency refers to the proportion of children (typically under age 15) in a population who are economically dependent on the working-age population (usually ages 15–64). It reflects how many young people each working adult is expected to support. A higher child dependency ratio means a larger share of the population consists of children, which can indicate greater pressure on households and public services like education, healthcare, and food security—especially in poorer regions.




```{r}


library(readr)
library(dplyr)

ipums_1991 <- read_csv("~/Desktop/IPUMS_DATASETS/IPUMS_1991.csv") %>%
  select(all_of(keep_cols)) %>%
  mutate(
    YEAR = 1991,
    LOCATION = "Rajshahi"
  )

ipums_2001 <- read_csv("~/Desktop/IPUMS_DATASETS/IPUMS_2001.csv") %>%
  select(all_of(keep_cols)) %>%
  mutate(
    YEAR = 2001,
    LOCATION = "Rajshahi"
  )

ipums_2011 <- read_csv("~/Desktop/IPUMS_DATASETS/IPUMS_2011.csv") %>%
  select(all_of(keep_cols)) %>%
  mutate(
    YEAR = 2011,
    LOCATION = "Rajshahi"
  )



```



```{r}

# Combine all three datasets
ipums_all <- bind_rows(ipums_2011, ipums_2001, ipums_1991) %>%
  mutate(LOCATION = "Rajshahi")

```


```{r}

rajshahi_data <- ipums_all




```


## Now, that I have zila level poverty data, Loading and cleaning the poverty data

```{r}
library(readxl)

# Path to the Excel file
poverty_data <- read_excel("~/Downloads/zila_and_upazila_data/zila_indicators.xlsx")

# Viewing the first few rows
head(poverty_data)


```

Rename columns for consistency
Let’s standardize division and zila names.

```{r}

poverty_clean <- poverty_data %>%
  rename(
    DIVISION = `Division Name`,
    ZILA = `Zila Name`,
    rural_pop_pct = `Rural Population (%)`,
    working_age_total = `Working-age population (N)`,
    working_age_pct = `Population between 15 and 64 years old, National avg (%)`,
    no_toilet_pct = `Households without toilet, open defecation (%)`
  ) %>%
  mutate(
    DIVISION = str_to_title(DIVISION),
    ZILA = str_to_title(ZILA)
  )





```


# Rename columns for consistency
Let’s standardize division and zila names.

```{r}



poverty_clean <- poverty_data %>%
  rename(
    DIVISION = `Division Name`,
    ZILA = `Zila Name`,
    rural_pop_pct = `Rural Population (%)`,
    working_age_total = `Working-age population (N)`,
    working_age_pct = `Population between 15 and 64 years old, National avg (%)`,
    no_toilet_pct = `Households without toilet, open defecation (%)`
  ) %>%
  mutate(
    DIVISION = str_to_title(DIVISION),
    ZILA = str_to_title(ZILA)
  )



```

# Renaming columns for consistency
Let’s standardize division and zila names.

```{r}

poverty_division <- poverty_clean %>%
  group_by(DIVISION) %>%
  summarise(
    avg_rural_pct = mean(rural_pop_pct, na.rm = TRUE),
    avg_working_age_pct = mean(working_age_pct, na.rm = TRUE),
    avg_no_toilet_pct = mean(no_toilet_pct, na.rm = TRUE),
    total_working_age_pop = sum(working_age_total, na.rm = TRUE)
  )


```

# Inspecting and filtering for Rajshahi

```{r}
poverty_rajshahi <- poverty_division %>%
  filter(DIVISION == "Rajshahi")

```


# Merge with your IPUMS/Rajshahi dataset

```{r}

# Adding poverty indicators into Rajshahi data (merging by LOCATION / DIVISION)
rajshahi_data <- rajshahi_data %>%
  left_join(poverty_rajshahi, by = c("LOCATION" = "DIVISION"))


```

While working with the poverty dataset, I included a variable like avg_no_toilet_pct, which measures the percentage of households without access to a toilet. At first, it might seem unrelated — but it's actually a powerful proxy for poverty or socioeconomic deprivation.

The reason this matters is that child dependency isn't just influenced by food prices or whether a household is urban or rural. Deeper structural factors like poverty play a big role too. If we don’t account for those, we risk misinterpreting the effect of other variables like rice prices.

So, by including this variable, I’m essentially trying to control for the underlying living conditions. It helps me isolate the effect of rice price variation more accurately, instead of capturing the effects of poverty disguised as something else.

In short, this small variable helps add context and realism to the model — because families facing poverty likely experience dependency, education, and fertility patterns very differently than more economically stable ones.


```{r}


# Summarizing microdata
rajshahi_summary <- rajshahi_data %>%
  group_by(YEAR, urban_rural = ifelse(URBAN == 1, "Urban", "Rural")) %>%
  summarise(
    avg_dep = mean(NCHILD / FAMSIZE, na.rm = TRUE),
    .groups = "drop"
  )



# Checking if the columns are there
colnames(rajshahi_summary)






```


```{r}




# Creating one full contextual table
rajshahi_contextual <- tibble(
  YEAR = c(1991, 2001, 2011),
  avg_price = c(13.7, 22.5, 30.6),
  avg_no_toilet_pct = c(40, 25, 12.2),
  avg_rural_pct = c(85, 83, 82.5),
  avg_working_age_pct = c(58, 60, 60.6),
  total_working_age_pop = c(9000000, 10000000, 11681840)
)



```


```{r}



# Merging into summary
rajshahi_summary <- rajshahi_summary %>%
  left_join(rajshahi_contextual, by = "YEAR")


```

```{r}


str(rajshahi_summary)


# Summarizing microdata
rajshahi_summary <- rajshahi_data %>%
  group_by(YEAR, urban_rural = ifelse(URBAN == 1, "Urban", "Rural")) %>%
  summarise(
    avg_child_dependency = mean(NCHILD / FAMSIZE, na.rm = TRUE),
    avg_famsize = mean(FAMSIZE, na.rm = TRUE),
    .groups = "drop"
  )

# Creating contextual variables (with separate values for Urban & Rural)
rajshahi_contextual <- tibble(
  YEAR = rep(c(1991, 2001, 2011), each = 2),
  urban_rural = rep(c("Rural", "Urban"), times = 3),
  avg_price = c(13.5, 13.5, 22.5, 22.5, 30.5, 30.5),  # example prices
  avg_no_toilet_pct = c(40, 38, 25, 20, 12.2, 9.5)    # update with true values
)

# Merging contextual variables into rajshahi_summary
rajshahi_summary <- rajshahi_summary %>%
  left_join(rajshahi_contextual, by = c("YEAR", "urban_rural"))


# Checking structure
str(rajshahi_summary)


```



```{r}


cor(rajshahi_summary$avg_price, rajshahi_summary$avg_no_toilet_pct, use = "complete.obs")




```
This is a very strong negative correlation (close to -1).

It suggests that as average rice prices increase, the percentage of households without toilet access (a proxy for poverty) decreases in the Rajshahi division.




Over time, as economic conditions improve (reflected through rising rice prices, possibly linked to inflation, agricultural shifts, or market integration),

Poverty may be decreasing, as reflected by better access to sanitation.

Moreover, higher rice prices are associated with lower poverty indicators in this context.


```{r}


names(rajshahi_data)




```




Let's find out what's the relationship between average rice prices and the percentage of households without toilet access in Rajshahi, using toilet access as a proxy for poverty. 
```{r}

ggplot(rajshahi_summary, aes(x = avg_price, y = avg_no_toilet_pct)) +
  geom_point(aes(color = urban_rural), size = 3) +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed") +
  labs(
    title = "Rice Prices vs. Poverty (Toilet Access) in Rajshahi",
    x = "Average Rice Price (BDT)",
    y = "% Households Without Toilet",
    color = "Area Type"
  ) +
  theme_minimal()



ggsave("rice_vs_poverty_toilet_access.png", width = 8, height = 5, dpi = 300)




```
Interpretation: Rice Prices vs. Poverty (Toilet Access) in Rajshahi
This plot explores the relationship between average rice prices and poverty levels, using % of households without toilet access as a proxy for poverty. Each point represents an observation from either urban or rural areas in Rajshahi.

🔍 Key Insights:
Strong Negative Relationship: The downward-sloping blue trend line shows that higher rice prices are associated with lower poverty levels. In other words, as the average rice price increases, the percentage of households without toilet access tends to decrease.

Urban vs. Rural:

In rural areas, we see higher levels of poverty (higher % without toilets) when rice prices are low.

Urban areas generally have better toilet access (lower poverty), even at similar rice price levels compared to rural counterparts.


Why This Might Happen:
In rural Rajshahi, many people rely on agriculture—especially rice farming—for income. So, lower rice prices can mean lower earnings, leading to poorer living conditions and fewer resources for basic needs like sanitation.

In contrast, urban households may be less directly impacted by rice prices and may benefit from better infrastructure or income sources, helping them maintain better access to sanitation regardless of price fluctuations.


Moreover, This graph adds a compelling layer to the poverty narrative in Rajshahi—rice prices aren't just about food costs, but also tied to household well-being and infrastructure, especially in rural communities.






# To better understand the drivers of child dependency in Rajshahi, I developed a linear regression model that incorporates key contextual variables. Specifically, I included:

Average Rice Price (avg_price): as a proxy for economic conditions—higher prices may reflect rising income or inflation, both of which can influence household behavior.

Percentage of Households Without Toilets (avg_no_toilet_pct): as a poverty indicator, capturing access to basic sanitation infrastructure.

Urban vs. Rural Classification (urban_rural): to account for structural and infrastructural differences between area types that likely impact family dynamics and dependency patterns.
```{r}


# Now, Including contextual variables in modeling

# Corrected model with contextual variables
model <- lm(avg_child_dependency ~ avg_price + avg_no_toilet_pct + urban_rural, 
            data = rajshahi_summary)
summary(model)




```


this model includes child dependency ratio (avg_dep) as a function of:

- Rice prices

- Poverty proxy (% without toilet)

- Urban vs. rural location


Interpretation: We fitted a linear model to examine how child dependency relates to economic (rice price), infrastructural (toilet access), and locational (urban/rural) variables. All predictors show marginal significance, with higher rice prices associated with lower child dependency. Urban areas tend to have slightly higher dependency ratios even after accounting for poverty indicators. 


```{r}


write.csv(rajshahi_summary, "rajshahi_summary_final.csv", row.names = FALSE)



```

```{r}

#install.packages("car")
library(car)
vif(model)



```
We checked for multicollinearity using the Variance Inflation Factor (VIF). The results revealed extremely high VIFs for avg_price and avg_no_toilet_pct (over 130), suggesting strong collinearity between these predictors. To ensure model reliability and interpretability, we re-specified the model using only one of these contextual variables at a time.

As a result, one of these variables was removed from the final model specification to improve interpretability and model stability.







# Modeling Child Dependency with Key Contextual Predictors
To better understand the variation in child dependency across Rajshahi over time, I fit a linear regression model using two key contextual predictors: average rice price (as a proxy for economic pressure) and area type (urban vs rural). The goal was to assess how child dependency is influenced by living costs and urban-rural differences while avoiding multicollinearity, especially since toilet access was strongly correlated with rice price.

The previous model reveals that urban areas tend to have a significantly higher child dependency ratio (by about 0.016) than rural areas, holding rice prices constant (p = 0.009). However, rice price itself was not a significant predictor (p = 0.40), suggesting that within this small sample, price fluctuations may not directly explain differences in dependency patterns. Despite the limited number of observations (n = 6), the model explains about 93% of the variance in child dependency (R² = 0.93), indicating a strong overall fit.

This simple model helps isolate how structural differences between urban and rural areas matter more than short-term price variations when it comes to household child dependency dynamics in Rajshahi.

```{r}

#re-specifying the model to avoid multicollinearity:

model_simple <- lm(avg_child_dependency ~ avg_price + urban_rural, data = rajshahi_summary)
summary(model_simple)


summary(model_simple)


```

Here,
Dependent variable: avg_dep (Child Dependency Ratio)

Predictors: avg_price (average rice price) and urban_rural (Urban/Rural dummy)

R² = 0.9285: The model explains 92.85% of the variation in child dependency — excellent fit.




Model Interpretation::
To address multicollinearity concerns, we re-specified the model by excluding avg_no_toilet_pct (which was highly collinear with rice price). The new model includes only average rice price and urban-rural classification as predictors of child dependency in Rajshahi Division.

The model performs well overall, with an R-squared of 92.85%, indicating that these two predictors explain a substantial portion of the variation in child dependency.

Urban areas are associated with a significantly higher child dependency ratio compared to rural areas, with an estimated effect size of 0.016 (p < 0.01).

The effect of rice price is negative but not statistically significant (p = 0.40), suggesting no strong evidence that rising rice prices directly reduce child dependency after accounting for area type.

This simplified model provides better interpretability and avoids distortion from multicollinearity, while still capturing key contextual differences between rural and urban settings.




# Now, preparing a clean summary dataset (rajshahi_summary_final) with key variables for further analysis.
Selected variables include year, urban/rural category, child dependency ratio, average rice price, and % of households without toilets (as a poverty proxy).


```{r}


rajshahi_summary_final <- rajshahi_summary %>%
  select(YEAR, urban_rural, avg_child_dependency, avg_price, avg_no_toilet_pct)






```
At this point, I was curious whether the effect of rice price on dependency differ between urban and rural areas?


# I am using a linear model with an interaction term between rice price and urban/rural area type to examine:

**Does the relationship between rice price and child dependency differ between urban and rural areas?**

```{r}

model_interaction <- lm(avg_child_dependency ~ avg_price * urban_rural, data = rajshahi_summary)
summary(model_interaction)





```

I tested an interaction model to assess whether the effect of rice price on child dependency differed between urban and rural areas. This interaction model yielded a high R-squared value (93.4%), indicating that the model explains a substantial proportion of the variation in child dependency across the six observations (three years × two area types). However, due to the very small sample size (n = 6), individual coefficient estimates are not statistically significant.

Key Findings:
The main effect of rice price (avg_price) is negative but not significant (p = 0.48), suggesting a slight inverse relationship with child dependency in rural areas (the reference group).

The urban-rural difference (urban_ruralUrban) is positive (0.012), indicating that, on average, urban areas tend to have higher child dependency than rural areas. However, this difference is also not statistically significant (p = 0.36).

The interaction term between rice price and urban area (avg_price:urban_ruralUrban) has a small positive coefficient (0.00017) but a high p-value (p = 0.735), indicating that the effect of rice price on child dependency does not significantly differ between urban and rural areas.

Now, creating predicted values from the interaction model

```{r}

# Adding predicted values to the data
rajshahi_summary$predicted_dep <- predict(model_interaction)

```

Plotting Actual values as points

Predicted values as lines


```{r}

preds <- predict(model_interaction, interval = "confidence")
rajshahi_summary <- cbind(rajshahi_summary, as.data.frame(preds))


# Checking for duplicate column names
which(duplicated(colnames(rajshahi_summary)))


```

Here, Predicted child dependency values and their confidence intervals were generated using a linear interaction model. These predictions were merged with the original dataset to enable visual comparison of fitted trends across urban and rural settings. No issues of column duplication were detected.




```{r}

# Now, I would like to add predicted values as labels ( helpful for interpretation):
ggplot(rajshahi_summary, aes(x = avg_price, color = urban_rural)) +
  geom_point(aes(y = avg_child_dependency), size = 3) +
  geom_line(aes(y = fit)) +
  geom_ribbon(aes(ymin = lwr, ymax = upr, fill = urban_rural), alpha = 0.2, color = NA) +
  geom_text(aes(y = fit, label = round(fit, 3)), vjust = -1, size = 3) +
  labs(
    title = "Predicted vs Actual Child Dependency by Rice Price",
    subtitle = "Rajshahi Division: Urban vs Rural",
    x = "Average Rice Price (BDT)",
    y = "Child Dependency Ratio",
    color = "Area Type",
    fill = "Area Type"
  ) +
  theme_minimal()


ggsave("rajshahi_child_dependency_plot.png", width = 8, height = 5, dpi = 300)

```
The plot compares observed and predicted child dependency ratios across varying rice prices, separately for urban and rural areas in Rajshahi Division. While child dependency appears slightly higher in urban areas, both trends show mild declines as rice prices rise. The predictions closely match the observed values, indicating the model fits well. Shaded bands represent confidence intervals, helping visualize uncertainty. Adding predicted values directly on the plot improves clarity and makes it easier to interpret how rice price changes relate to dependency patterns in different area types.


NB: Child dependency: The child dependency ratio is a demographic indicator that shows the number of children (aged 0–14) relative to the working-age population (aged 15–64). It reflects how many children each 100 working-age people are supporting.

Formula:
Child Dependency Ratio = (Population aged 0–14/ Population aged 15–64) × 100


```{r}

library(readxl)

# Loading the upazila-level poverty indicators
upazila_data <- read_excel("~/Downloads/zila_and_upazila_data/upazila_indicators.xlsx")

# Viewing the first few rows
head(upazila_data)

# Checking the column names and structure
glimpse(upazila_data)


```


Even though I don’t have household-level price or poverty data, I do know what the general price level and sanitation situation was like in Rajshahi in 1991, 2001, and 2011. So I’m assigning that year-level info to every household in that year to explore macro-micro relationships


```{r}



# Selecting and rename key variables
upazila_clean <- upazila_data %>%
  select(
    DIVISION = `Division Name`,
    ZILA = `Zila Name`,
    UPAZILA = `Upazila Name`,
    total_pop = `Total Population (N)`,
    rural_pct = `Rural Population (%)`,
    working_age_pct = `Population between 15 and 64 years old (%)`,
    poor_pct = `Poverty headcount ratio (%)`,
    extreme_poor_pct = `Extreme poverty headcount ratio (%)`,
    underweight_pct = `Percentage of underweight children (%)`,
    stunted_pct = `Percentage of stunted children (%)`,
    no_toilet_pct = `Households without toilet, open defecation (%)`
  ) %>%
  mutate(
    DIVISION = str_to_title(DIVISION),
    ZILA = str_to_title(ZILA),
    UPAZILA = str_to_title(UPAZILA)
  )



```


```{r}


library(sf)

# Adjusting the path to where the folder is
bgd_map <- st_read("~/Documents/bgd_adm_bbs_20201113_shp/bgd_admbnda_adm3_bbs_20201113.shp")

# Checking
glimpse(bgd_map)


```


Let's prepare the upazila level data
```{r}


# Let's standardize names to match shapefile
upazila_clean <- upazila_data %>%
  rename(
    division = `Division Name`,
    district = `Zila Name`,
    upazila = `Upazila Name`,
    poverty = `Poverty headcount ratio (%)`
  ) %>%
  mutate(across(c(division, district, upazila), ~str_to_title(.)))



```

 Joining upazila data with the shapefile

```{r}


# Joining by upazila name
bgd_upazila_joined <- bgd_map %>%
  left_join(upazila_clean, by = c("ADM1_EN" = "division", "ADM2_EN" = "district", "ADM3_EN" = "upazila"))

# Checking for missing values (join success)
sum(is.na(bgd_upazila_joined$poverty))




```
this shows that 61 upazilas have missing values (NA) for poverty after joining your spatial data (bgd_map) with your cleaned upazila data (upazila_clean).

Let's inspect unmatched rows

```{r}

bgd_upazila_missing <- bgd_upazila_joined %>%
  filter(is.na(poverty)) %>%
  select(ADM1_EN, ADM2_EN, ADM3_EN)


# Comparing with upazila_clean
unmatched <- anti_join(bgd_map, upazila_clean,
  by = c("ADM1_EN" = "division", "ADM2_EN" = "district", "ADM3_EN" = "upazila"))



```


Making sure the names are consistent
```{r}

upazila_clean <- upazila_clean %>%
  mutate(across(c(division, district, upazila), ~ str_trim(str_to_lower(.))))

bgd_map <- bgd_map %>%
  mutate(across(c(ADM1_EN, ADM2_EN, ADM3_EN), ~ str_trim(str_to_lower(.))))


# To join
bgd_upazila_joined <- bgd_map %>%
  left_join(upazila_clean, by = c("ADM1_EN" = "division", "ADM2_EN" = "district", "ADM3_EN" = "upazila"))


```

```{r}


names(bgd_upazila_joined)

library(ggplot2)

# Filter for Dhaka and Rajshahi divisions
dhaka_division <- bgd_upazila_joined %>% filter(ADM1_EN == "Dhaka")
rajshahi_division <- bgd_upazila_joined %>% filter(ADM1_EN == "Rajshahi")

```


```{r}


# Plotting
p <- ggplot(bgd_upazila_joined) +
  geom_sf(aes(fill = poverty), color = "white", size = 0.1) +  # Main poverty map

  # Add bold black border for Dhaka
  geom_sf(data = dhaka_division, fill = NA, color = "black", size = 1.2) +

  # Add bold blue border for Rajshahi
  geom_sf(data = rajshahi_division, fill = NA, color = "cyan", size = 1.2) +

  scale_fill_viridis_c(option = "plasma", direction = -1, name = "Poverty Rate (%)") +

  labs(
    title = "Upazila-Level Poverty in Bangladesh",
    subtitle = "Bold Black Border: Dhaka | Bold Cyan Border: Rajshahi"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 11),
    legend.position = "right"
  )
print(p)



```
Poverty in Dhaka Division
The highlighted black-bordered area represents Dhaka Division, now visually distinct from the rest of the country.

Compared to other regions:

Dhaka Division shows moderate-to-lower poverty rates, especially around urban/upazila centers near Dhaka city.

Some surrounding upazilas in Dhaka Division still show intermediate levels of poverty (orange/purple hues), indicating urban-rural disparity within the division.

Regional comparison:

Southwest (Barisal) and parts of the northwest show higher poverty.

Central regions like Dhaka, and pockets of Chattogram and Sylhet, appear less impoverished overall.



- Some upazilas are shaded in light gray on the map, indicating missing poverty data. This occurs when a geographic region in the shapefile does not have a corresponding poverty value in the data. The mismatch is likely due to naming inconsistencies or missing records in the original dataset. It is important to interpret these areas with caution, as the absence of data does not necessarily imply lower or higher poverty — it simply reflects a data gap.

Now let's focus on Rajshahi division and prepare the data
```{r}
unique(bgd_upazila_joined$ADM1_EN)


# Filtering 
rajshahi_map <- bgd_upazila_joined %>%
  filter(tolower(ADM1_EN) == "rajshahi")



bgd_upazila_joined <- bgd_upazila_joined %>%
  mutate(ADM1_EN = tolower(ADM1_EN))


rajshahi_map <- bgd_upazila_joined %>%
  filter(ADM1_EN == "rajshahi")

```



let's now focus on the top 5 poorest upazilas:


```{r}
# Create a combined set of top 5 and bottom 5 upazilas by poverty
# 1. Prepare labeled data with color groups
top_bottom_labels <- suppressWarnings(
  rajshahi_map %>%
    arrange(desc(poverty)) %>%
    slice_head(n = 5) %>%
    mutate(group = "Top 5") %>%
    bind_rows(
      rajshahi_map %>%
        arrange(poverty) %>%
        slice_head(n = 5) %>%
        mutate(group = "Bottom 5")
    ) %>%
    st_centroid()
)
```


```{r}
# Final ggplot with colored labels
ggplot(rajshahi_map) +
  geom_sf(aes(fill = poverty), color = "white", size = 0.15) +

  geom_text_repel(
    data = top_bottom_labels,
    aes(geometry = geometry, label = ADM3_EN, color = group),
    stat = "sf_coordinates",
    size = 4,
    fontface = "bold",
    max.overlaps = Inf,
    box.padding = 0.3,
    segment.size = 0.25
  ) +

  scale_fill_viridis_c(option = "plasma", direction = -1) +
  scale_color_manual(values = c("Top 5" = "yellow", "Bottom 5" = "black")) +
  guides(color = "none") +

  labs(
    title = "Top & Bottom 5 Upazilas by Poverty Rate (Rajshahi Division)",
    fill = "Poverty Rate (%)"
  ) +

  theme_minimal(base_size = 12) +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    panel.grid = element_blank(),
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
    legend.title = element_text(size = 10),
    legend.text = element_text(size = 9)
  )




```
Here, poorest Upazilas (outlined & labeled):
The top 5 poorest upazilas (like Godagari, Belkuchi, Chauhali, Bera, and Shahjadpur) are highlighted with bold red borders and labeled

Regional Insights:
The southeastern upazilas (like Belkuchi, Chauhali, Bera) and some western ones (Godagari) appear to have higher poverty, suggesting possible clustering of deprivation.


```{r}

# Visualizing the Trends
# let's see how child dependency changes with avg_price or poverty:
# Save the plot to an object
top_bottom_5_plot <- ggplot(rajshahi_summary, aes(x = avg_price, y = avg_child_dependency, color = urban_rural)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Child Dependency vs. Rice Price",
    x = "Avg Rice Price (BDT)",
    y = "Avg Child Dependency"
  ) +
  theme_minimal()




```
The scatter plot shows a slight negative correlation between average rice price and child dependency in both rural and urban areas. Interestingly, urban areas exhibit consistently higher child dependency ratios than rural areas, which may reflect differences in household structure, fertility patterns, or economic migration. While the inverse relationship with rice price aligns with expectations, the urban-rural gap in dependency challenges conventional assumptions and suggests the need for further investigation.


```{r}

bubble_plot <- ggplot(rajshahi_summary, aes(x = avg_price, y = avg_child_dependency, 
                                            size = avg_no_toilet_pct, color = urban_rural)) +
  geom_point(alpha = 0.7) +
  labs(
    title = "Child Dependency vs Rice Price (Bubble Size = Poverty)",
    x = "Avg Rice Price", 
    y = "Child Dependency", 
    size = "% No Toilet Access",
    color = "Area Type"
  ) +
  theme_minimal()




```
This bubble chart tells a more layered story about household vulnerability.

This chart shows how child dependency (how many kids each adult is supporting) changes depending on rice prices and poverty levels (measured by access to toilets).

1. Urban areas have higher child dependency.
Even though we often think rural families are bigger, in this case, urban families (the blue dots) are supporting more children per adult.
That might be because:

Young families with kids are moving to cities for work.

Urban slums may have higher birth rates.

Or simply, families in cities are structured differently.

2. As rice prices go up, families have fewer dependents.
Both in rural and urban areas, we see a gentle decline in child dependency as rice prices increase.
That might mean:

Higher rice prices reflect better economies or rising incomes.

Families may be choosing to have fewer children when life gets more expensive.

It could also reflect a general shift toward smaller, more stable households.

3. Poverty seems to go down when rice prices go up.
Look at the bubble sizes — they represent how many households don’t have a toilet.

The big bubbles (more poverty) show up when rice is cheap.

The small bubbles (less poverty) are where rice is more expensive.



That means, in Rajshahi, as the cost of rice rises (which could reflect economic progress), families tend to be smaller, child dependency drops, and poverty — measured through toilet access — improves.

Urban areas still have higher child dependency than rural ones, which could reflect different living situations, not just income.



```{r}



rajshahi_summary <- ipums_all %>%
  mutate(child_dependency = NCHILD / FAMSIZE) %>%
  group_by(YEAR, urban_rural = ifelse(URBAN == 1, "Urban", "Rural")) %>%
  summarise(
    avg_famsize = mean(FAMSIZE, na.rm = TRUE),
    avg_nchild = mean(NCHILD, na.rm = TRUE),
    avg_child_dependency = mean(child_dependency, na.rm = TRUE),
    .groups = "drop"
  )





```

Plotting Predictions vs Actuals:
This plot helps show how well the model fits and compares actual vs predicted values:

```{r}

library(ggplot2)

ggplot(rajshahi_summary, aes(x = YEAR, color = urban_rural)) +
  geom_line(aes(y = avg_famsize), size = 1) +
  geom_point(aes(y = avg_famsize), size = 2) +
  labs(
    title = "Average Family Size in Rajshahi (1991–2011)",
    x = "Year", y = "Avg Family Size",
    color = "Area Type"
  ) +
  theme_minimal()




ggsave("avg_family_size.png", width = 7, height = 5, dpi = 300)


```
This line graph tracks how average family size has changed over time in the Rajshahi Division — separately for urban and rural areas — across three census years: 1991, 2001, and 2011.

Interpretation: Over the 20-year span from 1991 to 2011, average family size in Rajshahi decreased overall, hitting a low in 2001 before slightly rising by 2011. Rural families experienced a more dramatic drop, which may be linked to effective family planning initiatives and demographic shifts. Interestingly, urban family sizes remained larger throughout, possibly reflecting different living arrangements or economic migration patterns. This trend reflects how evolving socioeconomic conditions — such as education, migration, and resource constraints — have influenced household composition across time.

This shows:

Even though cities are expected to have smaller families, urban areas had bigger households — possibly due to:

- More extended families living together,

- Or migration — young families moving to cities.


Now, Let's see  how child dependency changed alongside family size — did they move together?

```{r}


names(rajshahi_summary)


# Assigning the plot to a named object
child_dependency_trend_plot <- ggplot(rajshahi_summary, aes(x = YEAR, color = urban_rural)) +
  geom_line(aes(y = avg_child_dependency), size = 1.2) +
  geom_point(aes(y = avg_child_dependency), size = 2.5) +
  labs(
    title = "Child Dependency Over Time in Rajshahi",
    subtitle = "Urban vs Rural Trends (1991–2011)",
    x = "Year", y = "Avg Child Dependency",
    color = "Area Type"
  ) +
  theme_minimal()






```
I tried to create bar graphs here. But the line plot is more intuitive, since: It visually connects 1991 → 2001 → 2011, and clearly shows the direction of change over time for both urban and rural areas.According to the graph, 

**rural areas:**
- Very stable child dependency between 1991 and 2001, hovering around 0.164.

- Then a clear drop after 2001 — by 2011, it falls to under 0.159.

However, in urban areas: 
- Start off higher than rural, around 0.177 in 1991.

- Peaks slightly in 2001 (above 0.181), then also declines sharply by 2011.

So, urban child dependency is consistently higher, but both urban and rural areas follow a similar arc: stable or slightly rising in the 1990s, followed by a notable decline in the 2000s.


Interpretation:
Between 1991 and 2011, both rural and urban areas in Rajshahi experienced a gradual decline in child dependency. Urban areas consistently had a higher child dependency ratio than rural areas — possibly due to the presence of young migrant families, higher birth rates in lower-income urban communities, or differences in household composition. The sharp decline after 2001 suggests that fertility reductions and changing economic conditions began to reshape household structures more rapidly in both contexts. This trend reflects a broader demographic shift toward smaller, economically leaner households.


At this point, I wanted to compare Family Size and Child Dependency:
This will show whether family size trends align with child dependency.

```{r}

# Comparing Avg Family Size and Child Dependency Over Time
library(ggplot2)
library(tidyr)

# Reshaping for comparison
comparison_long <- rajshahi_summary %>%
  select(YEAR, urban_rural, avg_famsize, avg_child_dependency) %>%
  pivot_longer(cols = c(avg_famsize, avg_child_dependency),
               names_to = "metric", values_to = "value")

# Plot
# Creating the plot and assigning to an object
comparison_plot <- ggplot(comparison_long, aes(x = YEAR, y = value, color = urban_rural)) +
  geom_line(size = 1.2) +
  geom_point(size = 2.5) +
  facet_wrap(~metric, scales = "free_y", labeller = labeller(
    avg_famsize = "Average Family Size",
    avg_child_dependency = "Child Dependency Ratio"
  )) +
  labs(
    title = "Family Size vs Child Dependency Over Time",
    subtitle = "Rajshahi Division (Urban vs Rural)",
    x = "Year", y = "Value", color = "Area Type"
  ) +
  theme_minimal()



```
Family Size vs. Child Dependency Over Time
Rajshahi Division (Urban vs. Rural | 1991–2011)

# Observations: 

**Rural Areas:**
- Family size declined from ~4.9 (1991) to ~4.3 (2001), then rose to ~4.85 (2011).

- Child dependency remained stable until 2001, then dropped notably by 2011.

* This suggests shrinking households with fewer children, followed by stabilization or extended-family structures.


**Urban Areas:**

- Family size fell from ~5.5 to under 5 by 2001, then rose to ~5.3 in 2011.

- Child dependency was consistently higher than rural, peaked in 2001, then declined.



**Interpretation:** 
This combined plot highlights the demographic shift in Rajshahi from 1991 to 2011. Both urban and rural households saw declining family sizes and child dependency ratios between 1991 and 2001 — reflecting the country’s push toward smaller, more economically manageable families. Interestingly, while average family sizes rebounded slightly after 2001, child dependency continued to decline, especially in rural areas. This could point to growing adult populations or fewer births per household. Urban areas, while having larger families overall, also maintained higher child dependency, suggesting different migration and fertility dynamics across space.




Le's model Trends Over Time:
This model tests whether the trend in child dependency differs by 

```{r}
model_time <- lm(avg_child_dependency ~ YEAR * urban_rural, data = rajshahi_summary)
summary(model_time)


```
This linear regression  aims to model how average child dependency changes over time, considering differences between urban and rural areas.


While the overall model fit was strong (R² = 0.94), individual coefficients were not statistically significant due to the limited sample. The results suggest a slight downward trend in child dependency over time, with rural areas showing a marginally steeper decline than urban ones. However, these differences should be interpreted with caution, given the small number of observations.





# To expand the model with contextual variables (like poverty and family size) to better understand what might explain child dependency over time.


I am Reducing the number of predictors here because I had Too few observations: I only have 6 rows (3 years × 2 area types).

```{r}


rajshahi_summary <- rajshahi_summary %>%
  left_join(rajshahi_contextual, by = "YEAR")


#checking
names(rajshahi_summary)



model_simple <- lm(avg_child_dependency ~ avg_famsize + urban_rural.x, 
                   data = rajshahi_summary)
summary(model_simple)







```
To better understand what drives variation in child dependency over time in Rajshahi, we ran a simple linear model with:

- Average family size (avg_famsize)
- Urban vs Rural (urban_rural)




To explore what explains variation in child dependency, a linear regression model was built using average family size and urban/rural status as predictors. The model showed strong explanatory power (R² = 0.94), and confirmed that urban areas had significantly higher child dependency rates (p = 0.009), even after accounting for family size. 

This model shows that both family size and urban/rural location matter a lot when it comes to understanding child dependency in Rajshahi. As families get bigger, the number of children per adult tends to drop — perhaps because adults are sharing responsibilities or having fewer kids per household.

But what's really interesting is that urban areas have noticeably higher child dependency ratios, even when family sizes are the same. That could reflect a lot of things — like young migrant families settling in cities, or different fertility patterns in urban life.




# let's now create a bar chart that compares average child dependency across rice price categories, separately for urban vs. rural areas. Here's how to do it:


```{r}

str(rajshahi_summary$avg_price.y)
summary(rajshahi_summary$avg_price.y)
names(rajshahi_summary)



# Creating rice price categories
rajshahi_summary <- rajshahi_summary %>%
  mutate(price_group = cut(avg_price,
                           breaks = c(0, 18, 26, Inf),
                           labels = c("Low", "Medium", "High")))

```


```{r}

# Creating bubble plot:

# plotting
rice_vs_dependency_plot <- ggplot(rajshahi_summary, aes(
  x = avg_price,
  y = avg_child_dependency,
  color = urban_rural
)) +
  geom_point(size = 4) +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed") +
  geom_text(
    aes(label = scales::percent(avg_child_dependency, accuracy = 0.1)),
    vjust = -0.8,
    size = 3.5,
    show.legend = FALSE
  ) +
  labs(
    title = "Child Dependency vs. Rice Price in Rajshahi",
    subtitle = "Separate Trends for Urban and Rural Areas",
    x = "Average Rice Price (BDT)",
    y = "Child Dependency Ratio",
    color = "Area Type"
  ) +
  theme_minimal(base_size = 13)



```
This plot looks at how child dependency (the share of children in a household compared to working-age adults) relates to the average price of rice in Rajshahi Division — split by urban and rural areas.

Each point represents a data year (1991, 2001, 2011), and the labels show the child dependency ratio as percentages.

🔴 Rural Areas (Red):
As rice prices rise (from ~13 to ~30 BDT), the child dependency ratio declines slightly — from ~16.4% to ~15.9%.

This suggests that in rural areas, higher food costs may coincide with smaller or more adult-heavy households.

It may reflect economic pressure: when rice is expensive, rural families might limit family size or delay childbirth.

🔵 Urban Areas (Blue):
Urban child dependency starts higher (up to 18.1%) and also shows a small downward trend.

Even though cities typically offer better services and access, urban households have had more children per adult historically.




**The graph explores how child dependency ratios vary in relation to average rice prices across rural and urban areas in Rajshahi Division.**

- Rural Areas:
In rural settings, the child dependency ratio shows a modest decline as rice prices rise — decreasing from 16.3% at lower price points to 15.9% at higher ones. This trend may indicate that increasing economic pressures (reflected by rising staple food prices) could lead households to reduce the number of dependents. Possible explanations include declining birth rates, delayed childbearing, or shifts in family composition in response to changing costs of living.

- Urban Areas:
A similar downward trend is visible in urban areas, though the starting point is consistently higher — from 18.2% down to 17.5%. Despite urban areas typically offering better infrastructure and services, they exhibit higher child dependency ratios overall. This may reflect inward migration of families with children seeking employment, education, or better living conditions. It could also suggest different social dynamics in urban households compared to rural ones.





***Conclusion:***
This analysis reveals that rice prices, poverty, and child dependency are deeply interconnected — and these relationships vary between rural and urban areas.

In rural Rajshahi, lower rice prices may seem like good news for consumers, but they often signal hardship for farming families. When prices drop, so do farmers’ earnings, increasing household vulnerability and limiting access to basic services like sanitation. These conditions are often linked to larger families and higher child dependency, as children may be viewed as future labor or security.

In urban areas, the story is more complex. Higher rice prices can create strain, especially for low-income households. Yet, they may also reflect broader economic shifts — rising wages, infrastructure improvements, or market growth. These shifts often align with improved sanitation, smaller families, and declining child dependency, particularly where access to education and family planning is stronger.

Across both contexts, one thing is clear:

Child dependency is not just about family size or income — it’s shaped by deeper structural factors like poverty, market dynamics, and access to services.

Understanding these patterns helps us better design policies that address vulnerability not just through food prices, but through long-term investments in livelihoods, infrastructure, and human development.



```{r}

# Setting working directory
setwd("~/Desktop/Saimun_REDO")

# Save all plots into Plots folder
ggsave("Plots/monthly_seasonal_plot.png", plot = monthly_seasonal_plot, width = 8, height = 5, dpi = 300)

ggsave("Plots/rice_contribution_plot.png", plot = rice_contribution_plot, width = 8, height = 5, dpi = 300)


ggsave("Plots/child_dependency_trend.png", plot = child_dependency_trend_plot, width = 8, height = 5, dpi = 300)


ggsave("Plots/poverty_map_dhaka_rajshahi_highlighted.png", plot = p, width = 8, height = 5, dpi = 300)


ggsave("Plots/top_bottom_5_poverty_rajshahi.png", plot = top_bottom_5_plot, width = 8, height = 5, dpi = 300)


ggsave("Plots/child_dependency_bubble_plot.png", plot = bubble_plot, width = 8, height = 5, dpi = 300)


ggsave("Plots/famsize_vs_child_dependency_faceted.png", plot = comparison_plot, width = 8, height = 5, dpi = 300)




```

